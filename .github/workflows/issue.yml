name: "Sync MD files to Issues"

on:
  push:
    paths:
      - '**/*.md'
    branches:
      - main

jobs:
  create-or-update-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v39
        with:
          files: "**/*.md"

      - name: Create or update an issue for each changed file
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          for file in ${{ steps.changed-files.outputs.all_changed_files }}; do
            title="ğŸ“„ æ›´æ–°äº† $file"
            content=$(cat "$file")

            # æ£€æŸ¥æ˜¯å¦å·²æœ‰åŒå Issue
            issue_number=$(gh issue list --state open --search "$title" --json number --jq '.[0].number')
            
            if [[ -n "$issue_number" ]]; then
              # å¦‚æœ Issue å·²å­˜åœ¨ï¼Œæ›´æ–°å†…å®¹
              gh issue edit "$issue_number" --body "$content"
              echo "âœ… å·²æ›´æ–° Issue #$issue_number"
            else
              # å¦åˆ™åˆ›å»ºæ–°çš„ Issue
              gh issue create --title "$title" --body "$content" --label "auto-sync"
              echo "âœ¨ åˆ›å»ºäº†æ–°çš„ Issue"
            fi
